{% extends 'Authentication/base.html' %}

{% load filters %}
{% block content %}

<!--NAVIGATION-->
<!--RESPONSIVE-->

<nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light">
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01" aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
    <a class="navbar-brand"">Zalogowany jako: {{ user.username }}</a>
    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
        <li class="nav-item">
            <a class="nav-link" href="{% url 'logedin'%}">Strona główna</a>
        </li>
        <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Moje rodziny</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="{% url 'myfamilies'%}">Przeglądaj rodziny</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="{% url 'createfamily'%}">Stwórz rodzinę</a>
              <a class="dropdown-item" href="{% url 'joinfamily'%}">Dołącz do rodziny</a>
            </div>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Wydarzenia</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="{% url 'myevents'%}">Przeglądaj moje wydarzenia</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="{% url 'addevent'%}">Dodaj wydarzenie</a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'photos'%}">Zdjęcia</a>
          </li>
        <form action="{% url 'logoutuser' %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary btn-block">Wyloguj</button>
        </form>
    </ul>
  </div>
</nav>
<br><br>


{% if not my_families%}
<h2>Czas dołączyć do jakiejś rodziny</h2> <br>
<h4>Stwórz jako pierwszy swoją rodzię lub poproś osobę która zaprosiła Cię do Familiara o ID rodziny do której chciałbyś dołączyć</h4><br><br>
    <a href="{% url 'createfamily'%}" class="btn btn-primary btn-block">Stwórz rodzinę</a><br>
    <a href="{% url 'joinfamily'%}" class="btn btn-primary btn-block">Dołącz do istniejące rodziny</a><br>
{% else %}


<!--EVENTS-->


<h3>Nadchodzące wydarzenia:</h3><br>

{% for event in events_in_my_families %}
<div class="card shadow-sm p-3 mb-5 bg-white rounded">
  <div class="card-body">
    <h3 class="card-title"> {{ event.author }} </h3>
    <h5 class="card-title"> {{ event.occasion|upper }}</h5>
    <h5 class="card-title"> {{ event.day }} {{event.month|month}}</h5>
    <p class="card-text">{{ event.desc }}</p>
  </div>
</div>
<br>
{% endfor %}

<!--POST-->
<dvi>
<!--    CREATE POST-->
    <div>
        <form method="POST">
            {% csrf_token %}
            <h3>Dodaj post</h3>
            <input type="hidden" name="form_type" value="post">
           <textarea name='send_post' id='send_post' rows="3" cols="50" class="form-control"></textarea><br>
           <button type="submit" class="btn btn-success">Dodaj!</button>
        </form>
    </div>
 <br><br>
<!--    VIEW POSTS-->
    <div>
        {% if posts_in_my_families %}
            {% for post in posts_in_my_families %}
            <div class="card border-dark mb-3 shadow p-3 mb-5 bg-white rounded" style="max-width: 25rem;">
              <div class="card-header">Dodane: {{post.date |date:"m.d.Y - h:i"}}</div>
              <div class="card-body text-dark">
                <h5 class="card-title">{{ post.author }}</h5>
                <p class="card-text">{{ post.text }}.</p>
                  <!--                            delete post-->
                  {% if post.author == user.username %}
                    <form method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="form_type" value="delete">
                       <input name='post_to_delete' value="{{ post.pk }}" type=hidden >
                       <button type="submit" class="btn btn-danger btn-block">Usuń!</button>
                    </form>
                  {% endif %}
              </div>
            </div>
                 {% endfor %}
        {% else %}
        <h2>Nikt z Twoich rodzin nie dodał jeszcze posta, bądź pierwszy!</h2>
        {% endif %}
    </div>

<br>
<br>
<!--    PHOTOS-->
{% if photos_in_my_families %}

<div style="max-height:70vh;overflow:scroll;overflow-x: hidden;">
<div class="row justify-content-md-center">
    {% for photo in photos_in_my_families %}
  <div class="card col-sm-3 shadow-sm p-3 mb-5 bg-white rounded" style="margin:0.8em">
    <img class="card-img-top" src="{{ photo.photo.url }}" alt="Card image cap">
    <div class="card-body">
      <h5 class="card-title">{{ photo.author }}: {{ photo.title }}</h5>
      <p class="card-text">{{ photo.desc }}</p>
      <p class="card-text"><small class="text-muted">Dodane: {{photo.date |date:"m.d.Y - h:i"}}</small></p>
    </div>
  </div>
    {% endfor %}
</div>
</div>
<br><br>
{% endif %}
{% endif %}
{% endblock %}